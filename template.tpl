___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "categories": [
    "TAG_MANAGEMENT",
    "UTILITY",
    "PERSONALIZATION"
  ],
  "securityGroups": [],
  "displayName": "CookieHub CMP",
  "brand": {
    "id": "github.com_cookiehub-com",
    "displayName": "CookieHub",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "CookieHub is a fully featured easy to use Consent Management Platform (CMP), providing everything you need to make your website GDPR, CCPA, LGPD, CNIL and POPIA compliant.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "code",
    "displayName": "CookieHub Domain Code",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "STRING_LENGTH",
        "args": [
          8,
          8
        ]
      },
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "[0-9a-fA-F]{8}"
        ]
      }
    ],
    "help": "Type the 8 character domain code available in the CookieHub dashboard (Domain overview). If you haven\u0027t created your CookieHub account yet, you can register on cookiehub.com",
    "notSetText": "Type the 8 character domain code available in the CookieHub dashboard (Domain overview). If you haven\u0027t created your CookieHub account yet, you can register on cookiehub.com"
  },
  {
    "type": "SELECT",
    "name": "language",
    "displayName": "Language",
    "selectItems": [
      {
        "value": "sq",
        "displayValue": "Albanian"
      },
      {
        "value": "hy",
        "displayValue": "Armanian"
      },
      {
        "value": "bg",
        "displayValue": "Bulgarian"
      },
      {
        "value": "ca",
        "displayValue": "Catalan"
      },
      {
        "value": "zh",
        "displayValue": "Chinese"
      },
      {
        "value": "hr",
        "displayValue": "Croatian"
      },
      {
        "value": "cs",
        "displayValue": "Czech"
      },
      {
        "value": "da",
        "displayValue": "Danish"
      },
      {
        "value": "nl",
        "displayValue": "Dutch"
      },
      {
        "value": "en",
        "displayValue": "English"
      },
      {
        "value": "et",
        "displayValue": "Estonian"
      },
      {
        "value": "fi",
        "displayValue": "Finnish"
      },
      {
        "value": "fr",
        "displayValue": "French"
      },
      {
        "value": "de",
        "displayValue": "German"
      },
      {
        "value": "el",
        "displayValue": "Greek"
      },
      {
        "value": "hi",
        "displayValue": "Hindi"
      },
      {
        "value": "hu",
        "displayValue": "Hungarian"
      },
      {
        "value": "is",
        "displayValue": "Icelandic"
      },
      {
        "value": "id",
        "displayValue": "Indonesian"
      },
      {
        "value": "it",
        "displayValue": "Italian"
      },
      {
        "value": "ja",
        "displayValue": "Japanese"
      },
      {
        "value": "ko",
        "displayValue": "Korean"
      },
      {
        "value": "lv",
        "displayValue": "Latvian"
      },
      {
        "value": "lt",
        "displayValue": "Lithuanian"
      },
      {
        "value": "my",
        "displayValue": "Malay"
      },
      {
        "value": "no",
        "displayValue": "Norwegian"
      },
      {
        "value": "pl",
        "displayValue": "Polish"
      },
      {
        "value": "pt",
        "displayValue": "Portuguese"
      },
      {
        "value": "ro",
        "displayValue": "Romanian"
      },
      {
        "value": "ru",
        "displayValue": "Russian"
      },
      {
        "value": "sr",
        "displayValue": "Serbian"
      },
      {
        "value": "sk",
        "displayValue": "Slovak"
      },
      {
        "value": "es",
        "displayValue": "Spanish"
      },
      {
        "value": "sv",
        "displayValue": "Swedish"
      },
      {
        "value": "th",
        "displayValue": "Thai"
      },
      {
        "value": "tr",
        "displayValue": "Turkish"
      },
      {
        "value": "uk",
        "displayValue": "Ukrainian"
      },
      {
        "value": "vn",
        "displayValue": "Vietnamese"
      }
    ],
    "simpleValueType": true,
    "notSetText": "As configured in the CookieHub dashboard",
    "help": "You can select a language here to override the language settings selected for the domain in the CookieHub dashboard.\n\nYou can also select a variable to dynamicly set the language but make sure the value returned is the 2 character locale code.\n\nPlease note that the language selected here must be enabled for your domain.",
    "macrosInSelect": true
  },
  {
    "type": "CHECKBOX",
    "name": "consent_mode",
    "checkboxText": "Enable Consent Mode",
    "simpleValueType": true,
    "defaultValue": true,
    "help": "When enabled, CookieHub will read and update the consent mode state available in Google Tag Manager."
  },
  {
    "type": "CHECKBOX",
    "name": "iab_tcf",
    "checkboxText": "Enable IAB Transparency and Consent Framework (TCF)",
    "simpleValueType": true,
    "defaultValue": false,
    "help": "When enabled, the IAB TCF stub code will be injected. Please note that you must also enable IAB TCF from the CookieHub dashboard."
  },
  {
    "type": "CHECKBOX",
    "name": "iab_gpp",
    "checkboxText": "Enable IAB Global Privacy Platform (GPP)",
    "simpleValueType": true,
    "defaultValue": false,
    "help": "When enabled, the IAB GPP stub code will be injected. Please note that you must also enable IAB GPP from the CookieHub dashboard."
  },
  {
    "type": "GROUP",
    "name": "consent_state",
    "displayName": "Consent Mode Defaults",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "RADIO",
        "name": "security_storage_default",
        "displayName": "Necessary (security_storage)",
        "radioItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "granted",
        "enablingConditions": []
      },
      {
        "type": "RADIO",
        "name": "functional_storage_default",
        "displayName": "Preferences (functionality_storage and personalization_storage)",
        "radioItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "RADIO",
        "name": "analytics_storage_default",
        "displayName": "Analytics (analytics_storage)",
        "radioItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "RADIO",
        "name": "ad_storage_default",
        "displayName": "Marketing (ad_storage)",
        "radioItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "RADIO",
        "name": "ad_user_data_default",
        "displayName": "Sending user data related to advertising to Google (ad_user_data)",
        "radioItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "RADIO",
        "name": "ad_personalization_default",
        "displayName": "Personalized advertising (ad_personalization)",
        "radioItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true
      }
    ],
    "enablingConditions": [
      {
        "paramName": "consent_mode",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "help": "When Consent Mode is enabled, you can configure the defaults for each consent type here. This default value is used until the user has made a consent or until CookieHub is able to provide the correct state based on previous choices."
  },
  {
    "type": "GROUP",
    "name": "consent_mode_settings",
    "displayName": "Consent Mode Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "wait_for_update",
        "displayName": "Wait for update",
        "simpleValueType": true,
        "defaultValue": 2000,
        "valueUnit": "milliseconds",
        "help": "Used with Consent Mode. When a CMP loads asynchronously, it might not always run before Google tags. To handle such situations, the wait_for_update will specify how long in millisecond to wait before data is sent.",
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "url_passthrough",
        "displayName": "URL passthrough",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": true,
            "displayValue": "true"
          },
          {
            "value": false,
            "displayValue": "false"
          }
        ],
        "simpleValueType": true,
        "defaultValue": false,
        "help": "To improve ad click measurement quality when ad_storage is denied, you can optionally elect to pass information about ad clicks through URL parameters across pages using URL passthrough."
      },
      {
        "type": "PARAM_TABLE",
        "name": "region_defaults",
        "displayName": "Region defaults",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "region",
              "displayName": "Regions",
              "simpleValueType": true,
              "valueHint": "DE,NL,FR,BE"
            },
            "isUnique": true
          },
          {
            "param": {
              "type": "SELECT",
              "name": "region_functional_storage_default",
              "displayName": "Preferences (functionality_storage and personalization_storage)",
              "macrosInSelect": false,
              "selectItems": [
                {
                  "value": "denied",
                  "displayValue": "Denied"
                },
                {
                  "value": "granted",
                  "displayValue": "Granted"
                }
              ],
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "SELECT",
              "name": "region_analytics_storage_default",
              "displayName": "Analytics (analytics_storage)",
              "macrosInSelect": false,
              "selectItems": [
                {
                  "value": "denied",
                  "displayValue": "Denied"
                },
                {
                  "value": "granted",
                  "displayValue": "Granted"
                }
              ],
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "SELECT",
              "name": "region_ad_storage_default",
              "displayName": "Marketing (ad_storage)",
              "macrosInSelect": false,
              "selectItems": [
                {
                  "value": "denied",
                  "displayValue": "Denied"
                },
                {
                  "value": "granted",
                  "displayValue": "Granted"
                }
              ],
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "SELECT",
              "name": "region_ad_user_data_default",
              "displayName": "Sending user data related to advertising to Google (ad_user_data)",
              "macrosInSelect": false,
              "selectItems": [
                {
                  "value": "denied",
                  "displayValue": "Denied"
                },
                {
                  "value": "granted",
                  "displayValue": "Granted"
                }
              ],
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "SELECT",
              "name": "region_ad_personalization_default",
              "displayName": "Personalized advertising (ad_personalization)",
              "macrosInSelect": false,
              "selectItems": [
                {
                  "value": "denied",
                  "displayValue": "Denied"
                },
                {
                  "value": "granted",
                  "displayValue": "Granted"
                }
              ],
              "simpleValueType": true
            },
            "isUnique": false
          }
        ],
        "newRowTitle": "Add region",
        "newRowButtonText": "Add region",
        "editRowTitle": "Edit region"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "consent_mode",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "other_settings",
    "displayName": "Other Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "production",
        "displayName": "Production",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": true,
            "displayValue": "true"
          },
          {
            "value": false,
            "displayValue": "false"
          }
        ],
        "simpleValueType": true,
        "help": "On a production site this dropdown should be set to \"true\". When working on a development site you can set the value to \"false\" to be able to preview changes without publishing them on the production site.",
        "defaultValue": true
      },
      {
        "type": "TEXT",
        "name": "expiry_days",
        "displayName": "Consent lifetime",
        "simpleValueType": true,
        "defaultValue": 365,
        "help": "Number of days to store the user consent. Once the specified days have passed since the last consent the CookieHub dialog will be shown again.",
        "valueUnit": "days",
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "linker",
        "displayName": "CookieHub Linker",
        "simpleValueType": true,
        "help": "A comma seperated list of domains/hostnames. CookieHub Linker is used to forward consent state to different top level domains. CookieHub will automatically add a _cl parameter containing the consent state on links for the domains/hostnames specified in the linker textbox.",
        "canBeEmptyString": true,
        "valueHint": "cookiehub.com,cookiehub.de"
      },
      {
        "type": "SELECT",
        "name": "show_ui",
        "displayName": "Show user interface",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": true,
            "displayValue": "true"
          },
          {
            "value": false,
            "displayValue": "false"
          }
        ],
        "simpleValueType": true,
        "help": "Usually this variable should be set to true but using this option you can hide the CookieHub user interface on certain pages",
        "defaultValue": true
      },
      {
        "type": "SELECT",
        "name": "show_icon",
        "displayName": "Show settings icon",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": true,
            "displayValue": "true"
          },
          {
            "value": false,
            "displayValue": "false"
          }
        ],
        "simpleValueType": true,
        "help": "The visibility of the settings icon can be managed in the CookieHub dashboard but can be overridden using this field.",
        "notSetText": "As configured in the CookieHub dashboard"
      },
      {
        "type": "SELECT",
        "name": "render_position",
        "displayName": "Position of code",
        "selectItems": [
          {
            "value": "",
            "displayValue": "Default"
          },
          {
            "value": "top",
            "displayValue": "Top"
          },
          {
            "value": "bottom",
            "displayValue": "Bottom"
          }
        ],
        "simpleValueType": true,
        "help": "CookieHub will insert html code to your body tag containing the markup for the dialogs. By default the code is placed at the top of the body tag when enhanced accessibility is enabled but otherwise at the bottom."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
log('data =', data);

// Import the required modules
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');
const encodeUriComponent = require('encodeUriComponent');
const setInWindow = require('setInWindow');
const getCookie = require('getCookieValues');
const fromBase64 = require('fromBase64');
const JSON = require('JSON');
const gtagSet = require('gtagSet');

// Get the user provided settings
const code = data.code;
const production = (data.production != null ? (typeof data.production === 'string' ? data.production == 'true' : data.production) : false);
const consentMode = data.consent_mode;
const language = data.language;
const renderPosition = data.render_position;
const showUI = data.show_ui;
const showIcon = data.show_icon;
const expiryDays = data.expiry_days;
const regionDefaults = data.region_defaults;

// Stop processing if the CookieHub code is not provided
if (!code) {
  data.gtmOnFailure();
}

// Splits the input string using comma as a delimiter, returning an array of strings
const splitInput = (input) => {
  return input.split(',')
    .map(entry => entry.trim())
    .filter(entry => entry.length !== 0);
};

// Check if linker is provided and prepare an array og hostnames
let linker = [];
if (data.linker != undefined && typeof data.linker === 'string' && data.linker.trim() != '') {
  linker = splitInput(data.linker);
}

// Populate the gtmSettings object which is used to send configuration data to the CookieHub CMP
const gtmSettings = {
  'enabled': true,
  'consentMode': consentMode,
  'language': (language != null && language.length == 2 ? language : ''),
  'renderPosition': renderPosition,
  'showUI': (typeof showUI === 'string' ? (showUI == 'true') : showUI),
  'showIcon': showIcon,
  'expiryDays': (expiryDays != null && expiryDays != '' ? expiryDays : null),
  'linker': linker
};

setInWindow('cookiehub_gtm', gtmSettings, true);

if (consentMode) {
  gtagSet({
    url_passthrough: data.url_passthrough,
    'developer_id.dMzY0Yz': true
  });

  // Set the global consent defaults
  setDefaultConsentState({
    'security_storage': (data.security_storage_default && data.security_storage_default == 'granted' ? 'granted' : 'denied'),
    'functionality_storage': (data.functional_storage_default && data.functional_storage_default == 'granted' ? 'granted' : 'denied'),
    'personalization_storage': (data.functional_storage_default && data.functional_storage_default == 'granted' ? 'granted' : 'denied'),
    'analytics_storage': (data.analytics_storage_default && data.analytics_storage_default == 'granted' ? 'granted' : 'denied'),
    'ad_storage': (data.ad_storage_default && data.ad_storage_default == 'granted' ? 'granted' : 'denied'),
    'ad_user_data': (data.ad_user_data_default && data.ad_user_data_default == 'granted' ? 'granted' : 'denied'),
    'ad_personalization': (data.ad_personalization_default && data.ad_personalization_default == 'granted' ? 'granted' : 'denied'),
    'wait_for_update': data.wait_for_update
  });

  // Set regions defaults if provided
  if (regionDefaults != null)
  {
    regionDefaults.forEach(currentRegion => {
      const regionList = splitInput(currentRegion.region);
      if (regionList.length > 0) {
        setDefaultConsentState({
          'security_storage': (data.security_storage_default && data.security_storage_default == 'granted' ? 'granted' : 'denied'),
          'functionality_storage': currentRegion.region_functional_storage_default,
          'personalization_storage': currentRegion.region_functional_storage_default,
          'analytics_storage': currentRegion.region_analytics_storage_default,
          'ad_storage': currentRegion.region_ad_storage_default,
          'ad_user_data': currentRegion.region_ad_user_data_default,
          'ad_personalization': currentRegion.region_ad_personalization_default,
          'region': regionList
        });
      }
    });
  }

  // Check if the user has consented already
  if (getCookie('cookiehub') != undefined && getCookie('cookiehub').length > 0) {
    let chState = fromBase64(getCookie('cookiehub')[0]);
    if (chState == undefined) {
      chState = getCookie('cookiehub')[0];
    }

    if (chState != undefined && chState.indexOf('categories') > 0) {
      chState = JSON.parse(chState);

      if (chState.categories != undefined) {
        let security = true;
        let functional = false;
        let analytics = false;
        let ads = false;

        if (chState.allAllowed != undefined) {
          if (chState.allAllowed) {
            functional = true;
            analytics = true;
            ads = true;
          } else {
            functional = (chState.categories.indexOf(2) > -1);
            analytics = (chState.categories.indexOf(3) > -1);
            ads = (chState.categories.indexOf(4) > -1);
          }
        } else {
          for (let i=0; i < chState.categories.length; i++) {
            if (chState.categories[i].id == 'preferences') {
              functional = chState.categories[i].value;
            } else if (chState.categories[i].id == 'analytics') {
              analytics = chState.categories[i].value;
            } else if (chState.categories[i].id == 'marketing') {
              ads = chState.categories[i].value;
            }
          }
        }

        updateConsentState({
          'security_storage': (security ? 'granted' : 'denied'),
          'functionality_storage': (functional ? 'granted' : 'denied'),
          'personalization_storage': (functional ? 'granted' : 'denied'),
          'analytics_storage': (analytics ? 'granted' : 'denied'),
          'ad_storage': (ads ? 'granted' : 'denied'),
          'ad_user_data': (ads ? 'granted' : 'denied'),
          'ad_personalization': (ads ? 'granted' : 'denied')
        });
      }
    }
  }
}

let url = (production ? 'https://cdn.cookiehub.eu/c2/' : 'https://dash.cookiehub.com/dev/') + encodeUriComponent(code) + '.js';
if (queryPermission('inject_script', url)) {
  if (data.iab_tcf) {
    // Load the IAB TCF stub script if the user has enabled it
    injectScript('https://cdn.cookiehub.eu/tcf/v3/stub.js', function() {}, function() {});
  }

  if (data.iab_gpp) {
    // Load the IAB GPP stub script if the user has enabled it
    injectScript('https://cdn.cookiehub.eu/gpp/v3/stub.js', function() {}, function() {});
  }
  
  // Load the CookieHub CMP script
  injectScript(url, data.gtmOnSuccess, data.gtmOnFailure);
} else {
  // Call data.gtmOnFailure if the script cannot be injected
  data.gtmOnFailure();
}

// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.cookiehub.eu/"
              },
              {
                "type": 1,
                "string": "https://dash.cookiehub.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "cookiehub_gtm"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "cookiehub"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "developer_id.dMzY0Yz"
              },
              {
                "type": 1,
                "string": "url_passthrough"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 10/19/2021, 10:56:30 AM


